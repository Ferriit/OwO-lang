# OwO-Lang Specification

OwO-Lang is built on a set of core ideas:
1. **Pattern-finding over keywords:** the language is parsed and compiled primarily through structure and symbol patterns rather than reserved words  
2. **Compact expressiveness:** syntax should communicate maximum meaning with minimal visual noise  
3. **Non-clutterness:** symbols shouldn't be attached to a keyword or name to signify something else  

This can then be expanded to:

1. All types are fundamentally 16, 32 or 64-bit ints, there's no type-checking  
2. It builds on pattern-finding (if (x == 2) {} becomes x == 2 -> {})  
3. Function calls don't require parentheses (`printf("Hello, World!")` becomes `printf "Hello, World!"`. But `int x = y + f(z)` becomes `x := y + f(z)` since parentheses are needed for clarity)  
4. The language is fully procedural like C  
5. It compiles to an intermediary language before being compiled to assembly, assembled, and linked directly into binaries  
6. Variable definition doesn't need a special keyword since every variable is an int (except for strings and arrays, both of which are pointers). You just use `:=` instead of `=`  
7. Functions are defined without a keyword (`int main(int argc, char** argv) {}` becomes `main argc argv {}`)  
8. Assigning pointers shouldn't be with `*x`, it should use a keyword such as `mem` instead of `*`. (`&x` becomes `ref x`)  

---

## Compile Flags

### Target flags:
- (No target flag) — Compiles directly to 64-bit assembly and links into a binary.  
- `-compat` — Compiles using **32-bit** integers instead of 64-bit. Used for compatibility with 32-bit architectures.  
- `-fmbyas` — Compiles to the FMBYAS instruction set. Enables **16-bit** integers due to architecture limitations. Can be run either with the [EzCPU](https://github.com/Ferriit/EzCPU/tree/dev) emulator or the EzCPU in the game Scrap Mechanic (requires manually inputting machine code generated by the [EzCPU assembler](https://github.com/Ferriit/EzCPU/tree/dev)).  

### Linking flags:
- `-l[library name]` — Links whatever binary has that library name. Searches in your PATH.  
- `-L[path to library]` — Links whatever binary is at that path.  
- `-static` — Links statically.  
- `-shared` — Links dynamically (default).  
*(Note: FMBYAS doesn’t support dynamic linking.)*  

---

## Keywords:
1. **mem** — "Memory location of …". Assigns new memory for a constant and returns a pointer to that constant. If used on a variable (`mem x`), it’s equivalent to `*x` in C (pointer).  
2. **ref** — "Value at the memory location …". Equivalent to dereferencing (`&x`). **Always precedes `mem`.**  
3. **ret** — Returns the following value from a function.  
4. **loop** — An infinite loop (`loop {}` is the same as `while (true) {}`).  
5. **brk** — Breaks out of a loop (`break` in most languages).  
6. **jump** — Jumps to a specified label (`goto`).  
7. **imp** — Imports another OwO script or binary by its path or from PATH, using `<>` or `""`.  
8. **asm** — Insert an assembly instruction: `asm opcode arg1 arg2 arg3 …`. Works on every target.  
9. **mac** — Replaces every instance of the first value with the second (`mac [value] [replacement]`).  

---

## Variables

- All single-value variables are integers (64-bit by default, 32-bit if `-compat`, 16-bit if `-fmbyas`).  
- Strings and arrays are represented as pointers to memory locations.  

### Variable types:

#### Single-value:
- `int` behaves normally.  
- `bool` is false if equal to `0b0`, true otherwise.  
- `char` maps to integer character codes.  
- `float` is supported except under `-fmbyas`.  

#### Multi-value:
- Arrays and strings are pointers to memory.

##### Referencing:
- Uses `[]` as in C.

### Declaration:
- `x := 5` — defines an integer.  
- `y := mem "Hello"` — defines a pointer to a string in memory.  
- `z := mem ref y` — defines a pointer to what `y` points to.  

### Assignment:
- `x = 5` — assigns directly.  
- `y = mem x` — assigns pointer to memory location of `x`.  
- `z = mem ref x` — dereferences `x` and assigns its pointed value.  

---

## Functions

- Functions defined without a keyword:  
  ```owo
  main argc argv {}
  ```
- Return value: `ret [value]`.  
- Calls without needing parentheses:  
  ```owo
  printf "Hello, World!"
  ```
- When used in expressions, parentheses are required:  
  ```owo
  x := f(z) + y
  ```

---

## Flow Control

- `if`, `else if`, and `else` are replaced by arrow notation:
  ```owo
  x == 0 -> { printf "Zero"; }
  x == 1 !-> { printf "One"; }
  !-> { printf "Other"; }
  ```

---

## Loops

- Only one loop construct:  
  ```owo
  i := 0;
  loop {
      printf "%d" i;
      i++;
      i == 10 -> { brk; }
  }
  ```

Equivalent to:
```c
for (int i = 0; i < 10; i++) {
    printf("%d", i);
}
```

---

## Arithmetic, Comparison, and Logic
All standard operators behave as in C:  
`+, -, *, /, >>, <<, |, &, !, ||, &&, ==, !=, <=, >=, <, >`  
Compound operators (`++`, `--`, `+=`, `-=`, `*=`, `/=`) are also supported.  

---

## Including / Importing

- To include another OwO script or binary:
  ```owo
  imp <script_name.owo>
  imp "path/to/script.owo"
  imp <library_name.bin>
  imp "path/to/library.bin"
  ```

Only binary and script imports are supported — **C headers are not.**

---

## Comments

Single-line comments start with `//`  
```owo
// This is a comment
```

---

## Macros

Macros perform literal text replacement:
```owo
mac WIDTH 10;
```

---

## Build-target differences

- **Default / -compat:** Compiles directly to native assembly (64-bit or 32-bit) and links into a binary executable.  
- **-fmbyas:** Compiles to 16-bit FMBYAS assembly for the [EzCPU](https://github.com/Ferriit/EzCPU/tree/dev) architecture. Cannot handle floating-point numbers.  

### Standard libraries:
- **Default / -compat:** Uses the OwO standard binary libraries, linked statically or dynamically.  
- **-fmbyas:** Uses the `fmbylib` standard library, containing macros and minimal low-level instructions for register and I/O operations.  

### Limitations:
- `-compat`: 32-bit mode for legacy or constrained environments.  
- `-fmbyas`: 16-bit mode, no floating-point support, static linking only.
